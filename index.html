<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Navbar</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.3/font/bootstrap-icons.css">
  </head>
  
  <body class="bg-light-purple">
    <div id="loginModalSection"></div>
    <div id="otpModalSection"></div>
    <div id="signupModalSection"></div>
    <div id="signupOtpModalSection"></div>
    <div class="container bg-white py-2">
      
    </div>
  </body>
</html>
<script type="module">
  import MainNavbar from './components/MainNavbar.js';
  import BusinessNavbar from './components/BusinessNavbar.js';
  let prevContent = document.body.innerHTML;
  // MainNavbar();
  document.body.innerHTML = MainNavbar() + prevContent;
  prevContent = document.querySelector('body>.container.bg-white');
  prevContent.innerHTML = BusinessNavbar() + prevContent.innerHTML;
  let userBtn = document.querySelector('#userBtn');
  
  userBtn.addEventListener('mouseover', ()=>{
    let userBtnDropdownMenu = document.querySelector('#userBtnDropdownMenu');
    userBtnDropdownMenu.classList.add('show');
  });
  userBtn.addEventListener('mouseleave', ()=>{
    let userBtnDropdownMenu = document.querySelector('#userBtnDropdownMenu');
    userBtnDropdownMenu.addEventListener('mouseleave', ()=>{
      showMenu(userBtnDropdownMenu);
    });
  });
  let showMenu = (userBtnDropdownMenu)=>{
    userBtnDropdownMenu.classList.remove('show');
  }

  // Creating Modal Components
  import createModal from './components/Modals.js';
  // creating user 
  class User {
    constructor (contact) {
      this.contact = contact;
    }
  }
  let generateOTP = (otpVerify) => {
    if(otpVerify.length > 0) {
      otpVerify = '';
    }
    for(let i = 0; i < 4; i++) {
      let num = Math.round(Math.random()*10);
      if(num === 10) {
        num--;
      }
      otpVerify+=num;
    }
    return otpVerify;
  }
  // console.log(createModal);
  let loginModalSection = document.getElementById('loginModalSection');
  loginModalSection.innerHTML = createModal('loginModal','loginModalLabel','Sign In', 'Mobile Number', 'phoneNumber','mobileInput','Enter Your Mobile Number','loginModalNumberToOTPBtn','otpModal');
  let loginModalNumberToOTPBtn = document.getElementById('loginModalNumberToOTPBtn');
  let contact;
  let otpVerify = ''
  loginModalNumberToOTPBtn.addEventListener('click',()=>{
    // console.log('Hi');
    contact = document.getElementById('mobileInput').value;
    // console.log(contact);
    otpVerify = generateOTP(otpVerify);
    console.log('otpVerify:', otpVerify)
  });
  let otpModalSection = document.getElementById('otpModalSection');
  otpModalSection.innerHTML = createModal('otpModal', 'otpModalLabel', 'Login with One Time Password (OTP)', `Enter the 4 digit One Time Password (OTP) sent to your Mobile Number`,'otp','otpInput','X-X-X-X','otpModalButton','');
  let otpModalButton = document.getElementById('otpModalButton');
  otpModalButton.addEventListener('click',()=>{
    let otp = document.getElementById('otpInput').value;
    // console.log(otp);
    if(otp === otpVerify) {
      let userExists = false;
      let userTemp = JSON.parse(localStorage.getItem('users')) || [];
      let user;
      userTemp.forEach((el)=>{
        if(contact === el.contact) {
          userExists = true;
          user = el;
        }
      });
      if(userExists) {
        // console.log(user);
        localStorage.setItem('currentUser', JSON.stringify(user));
        window.location.reload();
      }
      else {
        alert('user does not exist');
      }
      
    }
    else {
      alert ('Invalid OTP');
    }
  });

  let signupModal = createModal('signupModal','signupModalLabel','Sign Up', 'Enter your mobileNumber','phoneNumber','signupPhoneNumber','Enter your phone number','signupModalButton','signupOtpModal');
  let signupModalSection = document.getElementById('signupModalSection');
  signupModalSection.innerHTML = signupModal;
  let signupOtpModalSection = document.getElementById('signupOtpModalSection');
  signupOtpModalSection.innerHTML = createModal('signupOtpModal', 'signupOtpModalLabel', 'Sign with One Time Password (OTP)', `Enter the 4 digit One Time Password (OTP) sent to your Mobile Number`,'otp','otpInputSignup','X-X-X-X','signupOtpModalButton','');
  let signupModalButton = document.getElementById('signupModalButton');
  signupModalButton.addEventListener('click',()=>{
    contact = document.getElementById('signupPhoneNumber').value;
    otpVerify = generateOTP(otpVerify);
    console.log(otpVerify);
  });
  let signupOtpModalButton = document.getElementById('signupOtpModalButton');
  signupOtpModalButton.addEventListener('click',()=>{
    let otp = document.getElementById('otpInputSignup').value;
    if(otp === otpVerify) {
      let user = new User(contact);
      let users = JSON.parse(localStorage.getItem('users')) || [];
      users.push(user);
      localStorage.setItem('users', JSON.stringify(users));
      localStorage.setItem('currentUser', JSON.stringify(user));
    }
  });

</script>
<script>
  let showSignUp = () => {
    console.log('Sign Up');
  }
  let businessNavbarNavItems = document.querySelectorAll('.businessNavbar');
  let logout = () => {
    localStorage.removeItem('currentUser');
    window.location.reload();
  }
</script>